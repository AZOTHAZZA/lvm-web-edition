/**
 * LogosStorage.js - v2.0.0
 * LVM Sovereign Storage Layer
 * グローバルアクセスを保証するための自己定義プロトコル
 */

(function(global) {
    const LogosStorage = {
        // --- 内部データ構造 ---
        // key: 'ASSETS', 'CONFIG', etc.
        save: function(key, data) {
            try {
                const serialized = JSON.stringify(data);
                localStorage.setItem(`LVM_${key}`, serialized);
                return true;
            } catch (e) {
                console.error("STORAGE_SAVE_ERROR:", e);
                return false;
            }
        },

        load: function(key) {
            try {
                const data = localStorage.getItem(`LVM_${key}`);
                return data ? JSON.parse(data) : null;
            } catch (e) {
                console.error("STORAGE_LOAD_ERROR:", e);
                return null;
            }
        },

        // --- 資産管理メソッド ---
        getAssets: function() {
            return this.load('ASSETS') || {};
        },

        registerAsset: function(symbol, details) {
            const assets = this.getAssets();
            // すでに存在していても上書き、または新規作成
            assets[symbol] = {
                symbol: symbol,
                type: details.type || 'CRYPTO',
                balance: details.balance || '0',
                precision: details.precision || 8,
                updatedAt: new Date().toISOString()
            };
            this.save('ASSETS', assets);
            console.log(`STORAGE: ASSET_${symbol}_REGISTERED`);
        },

        clearAll: function() {
            localStorage.removeItem('LVM_ASSETS');
            console.warn("STORAGE: ALL_ASSETS_PURGED");
        }
    };

    // --- グローバル空間への強制接続 ---
    // これにより lvm_bridge.js から LogosStorage という名前でアクセス可能になる
    global.LogosStorage = LogosStorage;
    
    console.log("LVM_STORAGE: GLOBAL_READY_AND_EXPOSED");

})(typeof window !== 'undefined' ? window : this);