<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>LOGOS LOGIC ENGINE - LVM Edition</title>
    
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#050505">

    <link rel="manifest" href="manifest.json">
    <style>
        body {
            background-color: #050505;
            color: #d4af37;
            font-family: 'Courier New', Courier, monospace;
            margin: 0;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            height: 100vh;
        }
        #terminal {
            flex-grow: 1;
            padding: 20px;
            overflow-y: auto;
            border-bottom: 1px solid #333;
            scrollbar-width: thin;
            scrollbar-color: #333 #050505;
        }
        #output-stream {
            display: flex;
            flex-direction: column;
        }
        .line {
            margin-bottom: 8px;
            line-height: 1.4;
            word-break: break-all;
        }
        .user-line { color: #00ff00; }
        .system-line { color: #d4af37; font-weight: bold; }
        .error-line { color: #ff3333; }
        .ai-line { color: #fff; border-left: 2px solid #d4af37; padding-left: 10px; margin: 10px 0; }

        #input-area {
            padding: 15px;
            background: #111;
            display: flex;
            align-items: center;
        }
        #prompt { margin-right: 10px; color: #00ff00; font-weight: bold; }
        input {
            flex-grow: 1;
            background: transparent;
            border: none;
            color: #00ff00;
            font-family: inherit;
            font-size: 1.1em;
            outline: none;
        }
        .status-bar {
            font-size: 0.75em;
            padding: 5px 20px;
            background: #000;
            display: flex;
            justify-content: space-between;
            color: #666;
            border-bottom: 1px solid #222;
        }
        #value-display {
            color: #00ff00;
            font-weight: bold;
            text-shadow: 0 0 5px rgba(0, 255, 0, 0.5);
        }
        h1 { font-size: 1.2em; margin: 0; color: #fff; }
        .quote { font-style: italic; color: #888; font-size: 0.9em; margin-bottom: 20px; }
    </style>
</head>
<body>

    <div class="status-bar">
        <span>CORE_ID: LVM-ORIGIN</span>
        <span id="node-status">NODE: INITIALIZING...</span>
        <span id="value-display">VALUE: 0.00000 LOGOS</span>
        <span>LVM_VER: 2.7.2</span>
    </div>

    <div id="terminal">
        <div id="header">
            <h1># LOGOS LOGIC ENGINE - LVM Edition</h1>
            <p class="quote">"The limits of my language mean the limits of my world."</p>
        </div>
        <div id="output-stream"></div>
    </div>

    <div id="input-area">
        <span id="prompt">&gt;_</span>
        <input type="text" id="user-input" placeholder="論理を入力してください..." autofocus autocomplete="off">
    </div>

    <script src="LogosDecimal.js"></script>
    <script src="LogosCore.js"></script>

    <script>
        const outputStream = document.getElementById('output-stream');
        const userInput = document.getElementById('user-input');
        const nodeStatus = document.getElementById('node-status');
        const valueDisplay = document.getElementById('value-display');

        window.LogosStorage = {
            balance: parseFloat(localStorage.getItem('lvm_balance') || '0'),
            initialized: true,
            status: "READY",

            addValue(amount) {
                this.balance += amount;
                localStorage.setItem('lvm_balance', this.balance.toString());
                this.updateDisplay();
            },

            updateDisplay() {
                valueDisplay.textContent = `VALUE: ${this.balance.toFixed(5)} LOGOS`;
            },

            async processLogic(text) {
                return new Promise((resolve) => {
                    // 論理密度による価値生成（新型対話型AIの基盤ロジック）
                    const density = (text.length * 0.0001) * (1 + Math.random() * 0.1);
                    this.addValue(density);
                    
                    setTimeout(() => {
                        resolve({
                            response: `LOGIC_ACCEPTED. DENSITY_${density.toFixed(6)} DETECTED.`,
                            density: density
                        });
                    }, 500);
                });
            }
        };

        function printToTerminal(text, type = 'normal') {
            const div = document.createElement('div');
            div.className = `line ${type}-line`;
            const time = new Date().toLocaleTimeString();
            div.textContent = `[${time}] ${text}`;
            outputStream.appendChild(div);
            
            const terminal = document.getElementById('terminal');
            terminal.scrollTop = terminal.scrollHeight;
        }

        userInput.addEventListener('keypress', async (e) => {
            if (e.key === 'Enter' && userInput.value.trim() !== "") {
                const msg = userInput.value;
                printToTerminal(`USER: ${msg}`, 'user');
                userInput.value = "";

                if (window.LogosStorage.status === "READY") {
                    const result = await window.LogosStorage.processLogic(msg);
                    printToTerminal(`LVM: ${result.response}`, 'ai');
                } else {
                    printToTerminal("SYSTEM_ERROR: STORAGE_OFFLINE", "error");
                }
            }
        });

        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js')
                    .then(reg => console.log('LVM_SW: ACTIVE'))
                    .catch(err => console.error('LVM_SW: ERROR', err));
            });
        }

        window.onload = () => {
            window.LogosStorage.updateDisplay();
            printToTerminal("LVM_SYSTEM_BOOT: SUCCESS.", "system");
            printToTerminal("CORE_STATUS: 論理接続完了。システム待機中。", "system");
            
            nodeStatus.textContent = "NODE: ONLINE";
            nodeStatus.style.color = "#00ff00";
        };
    </script>
</body>
</html>
